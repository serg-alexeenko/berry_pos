# Berry POS - –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Supabase

## üöÄ –®–≤–∏–¥–∫–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

### 1. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—Ä–æ–µ–∫—Ç—É –≤ Supabase

1. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –Ω–∞ [supabase.com](https://supabase.com)
2. –°—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤–∏–π –ø—Ä–æ–µ–∫—Ç
3. –°–∫–æ–ø—ñ—é–π—Ç–µ URL —Ç–∞ anon key –∑ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å –ø—Ä–æ–µ–∫—Ç—É

### 2. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω–Ω–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞

–°—Ç–≤–æ—Ä—ñ—Ç—å —Ñ–∞–π–ª `.env.local` –≤ –∫–æ—Ä–µ–Ω—ñ –ø—Ä–æ–µ–∫—Ç—É:

```bash
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
```

### 3. –í–∏–∫–æ–Ω–∞–Ω–Ω—è SQL —Å–∫—Ä–∏–ø—Ç—É

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ SQL Editor –≤ Supabase Dashboard
2. –í–∏–∫–æ–Ω–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç `supabase/clean-and-rebuild.sql`

–¶–µ–π —Å–∫—Ä–∏–ø—Ç:
- –í–∏–¥–∞–ª–∏—Ç—å –≤—Å—ñ —ñ—Å–Ω—É—é—á—ñ —Ç–∞–±–ª–∏—Ü—ñ —Ç–∞ —Ñ—É–Ω–∫—Ü—ñ—ó
- –°—Ç–≤–æ—Ä–∏—Ç—å –Ω–æ–≤—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É –±–µ–∑ —Ç–µ–Ω–∞–Ω—Ç—ñ–≤
- –ù–∞–ª–∞—à—Ç—É—î RLS –ø–æ–ª—ñ—Ç–∏–∫–∏
- –°—Ç–≤–æ—Ä–∏—Ç—å —Ç—Ä–∏–≥–µ—Ä –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

### 4. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

–ü—ñ—Å–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Å–∫—Ä–∏–ø—Ç—É –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ:

```sql
-- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü—å
SELECT tablename FROM pg_tables WHERE schemaname = 'public';

-- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü—ñ—ó
SELECT routine_name FROM information_schema.routines WHERE routine_name = 'handle_new_user';

-- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç—Ä–∏–≥–µ—Ä–∞
SELECT trigger_name FROM information_schema.triggers WHERE trigger_name = 'on_auth_user_created';
```

## üèóÔ∏è –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

### –û—Å–Ω–æ–≤–Ω—ñ —Ç–∞–±–ª–∏—Ü—ñ

1. **users** - –æ—Å–Ω–æ–≤–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Ç–∞ —ó—Ö –±—ñ–∑–Ω–µ—Å
2. **categories** - –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó —Ç–æ–≤–∞—Ä—ñ–≤
3. **products** - —Ç–æ–≤–∞—Ä–∏
4. **customers** - –∫–ª—ñ—î–Ω—Ç–∏
5. **orders** - –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
6. **order_items** - –ø–æ–∑–∏—Ü—ñ—ó –∑–∞–º–æ–≤–ª–µ–Ω—å

### Row Level Security (RLS)

–ö–æ–∂–µ–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–∞—î –¥–æ—Å—Ç—É–ø —Ç—ñ–ª—å–∫–∏ –¥–æ —Å–≤–æ—ó—Ö –¥–∞–Ω–∏—Ö:

- `users`: –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ –ø–µ—Ä–µ–≥–ª—è–¥–∞—Ç–∏ —Ç–∞ –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ —Ç—ñ–ª—å–∫–∏ —Å–≤—ñ–π –ø—Ä–æ—Ñ—ñ–ª—å
- `categories`, `products`, `customers`, `orders`: –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ –∫–µ—Ä—É–≤–∞—Ç–∏ —Ç—ñ–ª—å–∫–∏ —Å–≤–æ—ó–º–∏ –¥–∞–Ω–∏–º–∏
- `order_items`: –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ –∑–≤'—è–∑–æ–∫ –∑ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è–º–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

–ü—Ä–∏ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó —á–µ—Ä–µ–∑ Supabase Auth –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ:
1. –°—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –∑–∞–ø–∏—Å –≤ —Ç–∞–±–ª–∏—Ü—ñ `users`
2. –í—Å—Ç–∞–Ω–æ–≤–ª—é—î—Ç—å—Å—è —Ä–æ–ª—å `owner`
3. –°—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –±–∞–∑–æ–≤–∏–π –±—ñ–∑–Ω–µ—Å-–ø—Ä–æ—Ñ—ñ–ª—å

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è

### –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Auth –≤ Supabase

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ Authentication > Settings
2. –ù–∞–ª–∞—à—Ç—É–π—Ç–µ Email Auth
3. –û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ –Ω–∞–ª–∞—à—Ç—É–π—Ç–µ OAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∏ (Google, GitHub)

### Middleware

Middleware –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ:
- –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –Ω–∞ `/sign-in`
- –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∑ `/sign-in` –Ω–∞ `/dashboard`
- –ó–∞—Ö–∏—â–∞—î –≤—Å—ñ –±—ñ–∑–Ω–µ—Å-—Å—Ç–æ—Ä—ñ–Ω–∫–∏

## üì± –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ –∫–æ–¥—ñ

### –û—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

```typescript
import { useAuth } from '@/components/providers/AuthProvider';

function MyComponent() {
  const { user, loading } = useAuth();
  
  if (loading) return <div>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>;
  if (!user) return <div>–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–æ</div>;
  
  return <div>–í—ñ—Ç–∞—î–º–æ, {user.email}!</div>;
}
```

### –ó–∞–ø–∏—Ç–∏ –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

```typescript
import { supabase } from '@/lib/supabase/client';

// –û—Ç—Ä–∏–º–∞–Ω–Ω—è –∫–∞—Ç–µ–≥–æ—Ä—ñ–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
const { data: categories } = await supabase
  .from('categories')
  .select('*')
  .eq('user_id', user.id);

// –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ —Ç–æ–≤–∞—Ä—É
const { data: product } = await supabase
  .from('products')
  .insert({
    name: '–ù–∞–∑–≤–∞ —Ç–æ–≤–∞—Ä—É',
    price: 100,
    user_id: user.id
  })
  .select()
  .single();
```

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –¢–µ—Å—Ç–æ–≤–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—è

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–æ–¥–∞—Ç–æ–∫
2. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –Ω–∞ `/sign-up`
3. –°—Ç–≤–æ—Ä—ñ—Ç—å —Ç–µ—Å—Ç–æ–≤–∏–π –∞–∫–∞—É–Ω—Ç
4. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ —Å—Ç–≤–æ—Ä–∏–≤—Å—è –∑–∞–ø–∏—Å –≤ —Ç–∞–±–ª–∏—Ü—ñ `users`

### –¢–µ—Å—Ç RLS

1. –°—Ç–≤–æ—Ä—ñ—Ç—å –¥–≤–∞ —Ç–µ—Å—Ç–æ–≤–∏—Ö –∞–∫–∞—É–Ω—Ç–∞
2. –î–æ–¥–∞–π—Ç–µ –¥–∞–Ω—ñ –≤ –∫–æ–∂–µ–Ω –∞–∫–∞—É–Ω—Ç
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –Ω–µ –±–∞—á–∞—Ç—å –¥–∞–Ω—ñ –æ–¥–∏–Ω –æ–¥–Ω–æ–≥–æ

## üö® –ü–æ—à–∏—Ä–µ–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏

### –ü–æ–º–∏–ª–∫–∞ "RLS policy violation"

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ:
- –ß–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ RLS –ø–æ–ª—ñ—Ç–∏–∫–∏
- –ß–∏ –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è `user_id` –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –∑–∞–ø–∏—Å—ñ–≤
- –ß–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–∞—Ü—é—î `auth.uid()`

### –ü–æ–º–∏–ª–∫–∞ "function not found"

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ:
- –ß–∏ —Å—Ç–≤–æ—Ä–∏–ª–∞—Å—è —Ñ—É–Ω–∫—Ü—ñ—è `handle_new_user`
- –ß–∏ —Å—Ç–≤–æ—Ä–∏–≤—Å—è —Ç—Ä–∏–≥–µ—Ä `on_auth_user_created`

### –ü—Ä–æ–±–ª–µ–º–∏ –∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—î—é

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ:
- –ß–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞
- –ß–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π Auth –≤ Supabase Dashboard
- –ß–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–∞—Ü—é—î middleware

## üìö –î–æ–¥–∞—Ç–∫–æ–≤—ñ —Ä–µ—Å—É—Ä—Å–∏

- [Supabase Documentation](https://supabase.com/docs)
- [Supabase Auth](https://supabase.com/docs/guides/auth)
- [Row Level Security](https://supabase.com/docs/guides/auth/row-level-security)
- [Database Functions](https://supabase.com/docs/guides/database/functions)
