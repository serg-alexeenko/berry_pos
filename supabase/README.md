# Berry POS - –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Supabase

## üöÄ **–®–≤–∏–¥–∫–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö**

### **–ö—Ä–æ–∫ 1: –û—á–∏—â–µ–Ω–Ω—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ)**

–Ø–∫—â–æ —É –≤–∞—Å –≤–∂–µ —î —Å—Ç–∞—Ä—ñ —Ç–∞–±–ª–∏—Ü—ñ –∞–±–æ –≤–∏–Ω–∏–∫–∞—é—Ç—å –ø–æ–º–∏–ª–∫–∏, —Å–ø–æ—á–∞—Ç–∫—É –æ—á–∏—Å—Ç—ñ—Ç—å –±–∞–∑—É –¥–∞–Ω–∏—Ö:

1. **–í—ñ–¥–∫—Ä–∏–π—Ç–µ** Supabase Dashboard ‚Üí SQL Editor
2. **–°–∫–æ–ø—ñ—é–π—Ç–µ** –≤–µ—Å—å –≤–º—ñ—Å—Ç —Ñ–∞–π–ª—É `clean-and-rebuild.sql`
3. **–í—Å—Ç–∞–≤—Ç–µ** –≤ SQL Editor —Ç–∞ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å "Run" (‚ñ∂Ô∏è)
4. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ**, —â–æ –≤—Å—ñ –∑–∞–ø–∏—Ç–∏ –ø–æ–≤–µ—Ä–Ω—É–ª–∏ 0 —Ä—è–¥–∫—ñ–≤

### **–ö—Ä–æ–∫ 2: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—å —Ç–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è**

1. **–í SQL Editor** —Å–∫–æ–ø—ñ—é–π—Ç–µ –≤–µ—Å—å –≤–º—ñ—Å—Ç —Ñ–∞–π–ª—É `quick-setup.sql`
2. **–í—Å—Ç–∞–≤—Ç–µ** –≤ SQL Editor —Ç–∞ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å "Run" (‚ñ∂Ô∏è)
3. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏** - –º–∞—î –±—É—Ç–∏ —Å—Ç–≤–æ—Ä–µ–Ω–æ:
   - 7 —Ç–∞–±–ª–∏—Ü—å (tenants, users, categories, products, customers, orders, order_items)
   - 3 —Ç–∏–ø–∏ (user_role, order_status, payment_method)
   - –§—É–Ω–∫—Ü—ñ—è handle_new_user
   - –¢—Ä–∏–≥–µ—Ä on_auth_user_created –Ω–∞ auth.users
   - RLS –ø–æ–ª—ñ—Ç–∏–∫–∏ –¥–ª—è –≤—Å—ñ—Ö —Ç–∞–±–ª–∏—Ü—å

### **–ö—Ä–æ–∫ 3: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è**

–ü—ñ—Å–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è `quick-setup.sql` –≤–∏ –º–∞—î—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏:

#### **–¢–∞–±–ª–∏—Ü—ñ:**
```
| schemaname | tablename    | tableowner |
| ---------- | ------------ | ---------- |
| public     | tenants      | postgres   |
| public     | users        | postgres   |
| public     | categories   | postgres   |
| public     | products     | postgres   |
| public     | customers    | postgres   |
| public     | orders       | postgres   |
| public     | order_items  | postgres   |
```

#### **–§—É–Ω–∫—Ü—ñ—è:**
```
| routine_name    | routine_schema | security_type |
| --------------- | -------------- | ------------- |
| handle_new_user | public         | DEFINER       |
```

#### **–¢—Ä–∏–≥–µ—Ä:**
```
| trigger_name         | event_manipulation | event_object_table | action_timing | action_statement                   |
| -------------------- | ------------------ | ------------------ | ------------- | ---------------------------------- |
| on_auth_user_created | INSERT             | auth.users         | AFTER         | EXECUTE FUNCTION handle_new_user() |
```

### **–ö—Ä–æ–∫ 4: –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó**

1. **–í—ñ–¥–∫—Ä–∏–π—Ç–µ** [localhost:3000/sign-up](http://localhost:3000/sign-up)
2. **–°—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤–∏–π –∞–∫–∞—É–Ω—Ç** –∑ –Ω–æ–≤–∏–º email
3. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ**, —â–æ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –ø—Ä–æ–π—à–ª–∞ —É—Å–ø—ñ—à–Ω–æ
4. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å—Ç–∞—Ç—É—Å –±–∞–∑–∏ –¥–∞–Ω–∏—Ö:**
   ```bash
   curl -X POST http://localhost:3000/api/supabase/check-status
   ```

## üéØ **–©–æ –º–∞—î –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ:**

- **–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞** —Å—Ç–≤–æ—Ä—é—î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ:
  - –ù–æ–≤–∏–π tenant (—Ä–µ—Å—Ç–æ—Ä–∞–Ω) –≤ `public.tenants`
  - –ü—Ä–æ—Ñ—ñ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤ `public.users` –∑ —Ä–æ–ª–ª—é "owner"
- **–ö–æ–∂–µ–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á** –º–∞—î —Å–≤—ñ–π –≤–ª–∞—Å–Ω–∏–π tenant
- **–î–∞–Ω—ñ —ñ–∑–æ–ª—å–æ–≤–∞–Ω—ñ** –º—ñ–∂ —Ä—ñ–∑–Ω–∏–º–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏ —á–µ—Ä–µ–∑ RLS

## üîß **–Ø–∫—â–æ –≤–∏–Ω–∏–∫–∞—é—Ç—å –ø–æ–º–∏–ª–∫–∏:**

1. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏** –≤ Supabase Dashboard ‚Üí Logs ‚Üí Database
2. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ RLS –ø–æ–ª—ñ—Ç–∏–∫–∏** —Ç–∞ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É
3. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π —Ç—Ä–∏–≥–µ—Ä** –Ω–∞ `auth.users`
4. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ —Ñ—É–Ω–∫—Ü—ñ—è handle_new_user** –º–∞—î –ø—Ä–∞–≤–∞ DEFINER

## üìÅ **–§–∞–π–ª–∏:**

- `clean-and-rebuild.sql` - –æ—á–∏—â–µ–Ω–Ω—è –≤—Å—ñ—Ö –¥–∞–Ω–∏—Ö
- `quick-setup.sql` - —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—å —Ç–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
- `quick-seed.sql` - —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–µ—Å—Ç–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)

## üöÄ **–ü—ñ—Å–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è:**

–°–∏—Å—Ç–µ–º–∞ –º–∞—î –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ "–∑ –∫–æ—Ä–æ–±–∫–∏"! –ö–æ–∂–µ–Ω –Ω–æ–≤–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ—Ç—Ä–∏–º–∞—î:
- –í–ª–∞—Å–Ω–∏–π tenant (—Ä–µ—Å—Ç–æ—Ä–∞–Ω)
- –ü—Ä–æ—Ñ—ñ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ —Ä–æ–ª–ª—é "owner"
- –ü–æ–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø –¥–æ —Å–∏—Å—Ç–µ–º–∏
- –Ü–∑–æ–ª—å–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ –≤—ñ–¥ —ñ–Ω—à–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
